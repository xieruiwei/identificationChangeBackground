<div align="center"> 
	<img src="https://i.imgur.com/PNuxPd6.png" width=""/>
	<div style="font-weight:900">证件智能拍</div>
</div>

# 证件智能拍相关说明 #
## 软件使用说明 ##
1. 打开微信移动客户端，搜索《证件智能拍》
2. 点击进入《证件智能拍》小程序即可使用

## 作品效果图 ##
 

首页
![](https://i.imgur.com/Qbs7BSD.png)

相机拍照&图库选择
![](https://i.imgur.com/VIWKixe.png)

是否美颜&选择背景颜色&选择尺寸
![](https://i.imgur.com/UuGmeaW.png)

保存,下载
 ![](https://i.imgur.com/AAuHjBN.png)



# 作品思路 #

流程图：
![](https://i.imgur.com/y7Gt2tN.png)

## 进入小程序，点击拍摄按钮，弹出小程序使用规范。 ##
### 规范如下： ###

1. 整理拍摄

2. 纯色背景（背景越简单，人脸与背景分割更精准）

3. 深色衣服

4. 发型光滑、不乱翘

5. 头顶和两侧预留足够空间

## 确认了解使用规范后，进入另一页面，获取摄像头权限。根据摄像头提供的人脸轮廓进行拍摄或从图库选择适合图片后，上传图片，进行人脸检测分析。 ##

### 人脸分析结果类型： ###

1. 图片是否符合规格，是否是正常图片

2. 人脸数是否为1个人脸

3. 人脸清晰度

4. 人脸完整度

5. 人脸旋转度


## 不符合以上人脸分析任何一点，则提醒用户错误类型，进行重新拍摄上传。
符合以上所有人脸分析则进行人脸切割缩放。
再根据用户选择的证件照是否轻度美颜，证件照背景颜色，尺寸进行合成，制作成证件照。

## 最后保存下载证件照 ##

# 设计重点难点 #
## 1 人脸检测 ##

### 调用人脸检测识别接口，获取人脸数据。根据获取的人脸数据做以下操作: ###

(1) 判断用户是否连接网络，上传图片是否正常。否则返回信息——人脸分析：请上传正脸的照片

(2) 判断图片是否符合规格，若图片为空，或者动漫脸，动物脸，无人脸等则返回信息——人脸分析：请上传正确规格照片

(3) 判断人脸数是否为1个，否则返回信息——人脸分析：证件照只需要单人的哦~

(4) 判断图片是否清晰。人脸模糊程度的范围为[0~1]，0表示清晰，1表示模糊。人脸模糊程度超过50%，则返回信息——人脸分析：请上传清晰的照片

(5) 判断人脸是否完整。人脸完整度，0或1, 0为人脸溢出图像边界，1为人脸都在图像边界内。人脸不完整，则返回信息——人脸分析：请上传完整脸型的照片

(6) 判断人脸是否倾斜。人脸旋转度，旋转角度超过30度，则返回信息——人脸分析：请上传正脸的照片

通过以上所有检测，则将人脸眼睛以及嘴巴所处像素点传到人脸切割进一步处理

 

## 2 人脸切割 ##

根据人脸检测得到的人脸眼睛，嘴巴的位置，根据比例切割出符合证件照规格的人脸。

定义

(1) 人脸高度：人脸长度为眼睛到嘴巴的距离。

(2) 人脸宽度：人脸宽度为左右眼睛到右眼睛的距离。

眼睛到图片上边缘距离为0.6个人脸高度，眼睛到图片下边缘距离为1.3个人脸高度。左眼睛到图片左边缘为一个人脸宽度，右眼睛到图片右边缘为一个人脸宽度。根据四个维度进行人脸切割，保存人脸切割图片

 

## 3 人脸与背景分割 ##

调用百度AI人脸分割接口，获取人脸的mask区域信息。

根据mask区域信息，与原图像信息进行像素相减，再根据人脸轮廓边缘进行轮廓优化，去除边缘差，最后高清缩放图片，从而得到人脸与背景分割效果图片。

 

## 4 人脸美颜 ##

美颜用EPFFilter原理美化人脸。一个保边滤波器，双边滤波，导向滤波，域变换滤波器等。

合成公式如下：

Dest=(Src∗(100−Opacity)+(Src+2∗GuassBlur(EPFFilter(Src)−Src+128) −256)∗Opacity)/100；

 

## 5 根据用户选择制作证件照 ##

根据用户前端选择的证件照颜色及尺寸，进行人脸分割后的图片缩放。最后再与服务器已有规格的背景进行合成，生成证件照。
